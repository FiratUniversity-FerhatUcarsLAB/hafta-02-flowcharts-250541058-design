digraph ATM {
  rankdir=TB;
  splines=true;
  node [fontname="Helvetica", fontsize=10];

  // Node shape definitions
  Start [label="Başla", shape=oval];
  PromptPIN [label="PIN Gir", shape=box];
  CheckPIN [label="PIN Doğru?", shape=diamond];
  IncrementPIN [label="pinAttempts++", shape=box];
  ShowRemaining [label="Kalan deneme göster", shape=box];
  BlockCard [label="Kart bloke\n(4 yanlış)", shape=box, style=filled, fillcolor="#ffcccc"];
  AuthSuccess [label="Doğrulandı", shape=oval];

  ShowMenu [label="Menü göster\n(1:Bakiye, 2:Çek, 3:Çıkış)", shape=box];
  Choice [label="Seçim?", shape=diamond];

  ShowBalance [label="Bakiye göster", shape=box];
  PromptAmount [label="Çekilecek tutarı gir", shape=box];
  CheckDailyCount [label="Günlük işlem kaldı mı?\n(dailyWithdrawCount < 9)", shape=diamond];
  CheckRange [label="Tutar 90-9000 arasında mı?", shape=diamond];
  CheckBalance [label="Bakiye yeterli mi?", shape=diamond];
  WithdrawSuccess [label="Para çekildi\n(bakiye -= amount,\ndailyWithdrawCount++)", shape=box, style=filled, fillcolor="#ccffcc"];
  WithdrawFail [label="İşlem reddedildi\n(hata mesajı göster)", shape=box, style=filled, fillcolor="#ffe6cc"];

  Exit [label="Çıkış\n(Program sonlanır)", shape=oval];

  // Authentication loop edges
  Start -> PromptPIN;
  PromptPIN -> CheckPIN;
  CheckPIN -> AuthSuccess [label="evet"];
  CheckPIN -> IncrementPIN [label="hayır"];
  IncrementPIN -> ShowRemaining;
  ShowRemaining -> CheckPIN [label="pinAttempts < 4"];
  IncrementPIN -> BlockCard [label="pinAttempts == 4"];
  BlockCard -> Exit;

  // After auth
  AuthSuccess -> ShowMenu;

  // Menu choices
  ShowMenu -> Choice;
  Choice -> ShowBalance [label="1"];
  Choice -> PromptAmount [label="2"];
  Choice -> Exit [label="3"];
  Choice -> ShowMenu [label="başka / geçersiz", tooltip="Geçersiz seçim -> menüye dön"];

  // Show balance flow
  ShowBalance -> ShowMenu;

  // Withdraw flow checks
  PromptAmount -> CheckDailyCount;
  CheckDailyCount -> WithdrawFail [label="hayır", tooltip="Günlük hak doldu"];
  CheckDailyCount -> CheckRange [label="evet"];
  CheckRange -> WithdrawFail [label="hayır", tooltip="Tutar 90-9000 aralığında değil"];
  CheckRange -> CheckBalance [label="evet"];
  CheckBalance -> WithdrawFail [label="hayır", tooltip="Bakiye yetersiz"];
  CheckBalance -> WithdrawSuccess [label="evet"];
  WithdrawSuccess -> ShowMenu;
  WithdrawFail -> ShowMenu;

  // Styling for important nodes
  node [shape=box];
  { rank = same; CheckDailyCount; CheckRange; CheckBalance; }

  // Notes (invisible node) for constants
  Consts [label="Sabitler:\nMAX_DAILY_WITHDRAWS=9\nMIN_PER_WITHDRAW=90\nMAX_PER_WITHDRAW=9000\nINITIAL_BALANCE=30000\nMAX_PIN_ATTEMPTS=4", shape=note];
  Start -> Consts [style=dotted, arrowhead=none];

  // Prevent overlapping labels too much
  edge [fontsize=9];
}

}
